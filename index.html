<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Udacity Todos Goals</title>

    <link rel="stylesheet" href="index.css" />
  </head>

  <body>
    <main>
      <section id="app">
        <h2 style="display: none">React App</h2>
      </section>
    </main>

    <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>
    <script src="index.js"></script>
    <!-- <script src="react.js"></script> -->
    <script type="text/babel">
      /**
       * Definition for TODO
       * @typedef {Object} todo
       * @property {string} id - todo ID
       * @property {boolean} complete - todo complete status
       * @property {string} name - todo name
       */

      /**
       * Definition for Goal
       * @typedef {Object} goal
       * @property {string} id - goal ID
       * @property {string} name - goal name
       */

      /**
       * Renders the List component UI
       * @returns {object} - The UI DOM object
       * @param {object} props - List component props
       * @param {todo[] | goal[]} props.items - The list items
       * @param {function} props.remove - Remove item function
       * @param {function} [props.toggle] - Toggle todo function
       */
      const List = ({ items, remove, toggle }) => (
        <ul>
          {items.map((item) => (
            <li key={item.id}>
              <span
                onClick={() => toggle && toggle(item.id)}
                style={{ textDecoration: item.complete && "line-through" }}
              >
                {item.name}
              </span>
              <button onClick={() => remove(item.id)}>X</button>
            </li>
          ))}
        </ul>
      );

      /**
       * Todos component
       * @constructor
       */
      class Todos extends React.Component {
        /**
         * Adds a todo
         * @param {object} e - JS event object
         */
        addItem = (e) => {
          e.preventDefault();

          const name = this.input.value;
          this.input.value = "";

          this.props.store.dispatch(
            addTodoAction({
              id: generateId(),
              complete: false,
              name,
            })
          );
        };

        /**
         * Remove a todo
         * @param {string} id - The todo id
         */
        removeItem = (id) => this.props.store.dispatch(removeTodoAction(id));

        /**
         * Toggle a todo
         * @param {string} id - the todo id
         */
        toggleItem = (id) => this.props.store.dispatch(toggleTodoAction(id));

        /**
         * Renders the Todos component UI
         * @returns {object} - The UI DOM object
         */
        render() {
          return (
            <div>
              <h1>Todos List</h1>

              <form>
                <input
                  type="text"
                  placeholder="Add Todo"
                  aria-label="todo"
                  ref={(input) => (this.input = input)}
                />
                <button onClick={this.addItem}>Add Todo</button>
              </form>

              <List
                items={this.props.todos}
                remove={this.removeItem}
                toggle={this.toggleItem}
              />
            </div>
          );
        }
      }

      /**
       * Goals component
       * @constructor
       */
      class Goals extends React.Component {
        /**
         * Adds a goal
         * @param {object} e - JS event object
         */
        addItem = (e) => {
          e.preventDefault();

          const name = this.input.value;
          this.input.value = "";

          this.props.store.dispatch(
            addGoalAction({
              id: generateId(),
              name,
            })
          );
        };

        /**
         * Removes a goal
         * @param {string} id - The goal id
         */
        removeItem = (id) => this.props.store.dispatch(removeGoalAction(id));

        /**
         * Renders the Goals component UI
         * @returns {object} - the UI DOM object
         */
        render() {
          return (
            <div>
              <h1>Goals</h1>

              <form>
                <input
                  type="text"
                  placeholder="Add Goal"
                  aria-label="goal"
                  ref={(input) => (this.input = input)}
                />

                <button onClick={this.addItem}>Add Goal</button>
              </form>
              <List items={this.props.goals} remove={this.removeItem} />
            </div>
          );
        }
      }

      /**
       * App component
       * @constructor
       */
      class App extends React.Component {
        /**
         * Lifecycle method that runs after component has mounted
         */
        componentDidMount() {
          this.props.store.subscribe(() => this.forceUpdate());
        }

        /**
         * Renders the App component UI
         * @returns {object} - The UI DOM object
         */
        render() {
          const { store } = this.props;

          const { todos, goals } = store.getState();

          return (
            <div>
              <h2>App</h2>
              <Todos store={store} todos={todos} />
              <Goals store={store} goals={goals} />
            </div>
          );
        }
      }

      ReactDOM.render(<App store={store} />, document.getElementById("app"));
    </script>
  </body>
</html>
