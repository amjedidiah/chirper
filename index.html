<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Udacity Todos Goals</title>

    <link rel="stylesheet" href="index.css" />
  </head>

  <body>
    <main>
      <section id="app">
        <h2 style="display: none">React App</h2>
      </section>
    </main>

    <!-- React -->
    <script src="https://unpkg.com/react@16.3.0-alpha.1/umd/react.development.js"></script>

    <!-- ReactDOM -->
    <script src="https://unpkg.com/react-dom@16.3.0-alpha.1/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    <!-- Redux -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"></script>

    <!-- Redux Thunk -->
    <script src="https://unpkg.com/redux-thunk@2.2.0/dist/redux-thunk.min.js"></script>

    <!-- Redux Promise Middleware -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/redux-promise-middleware/6.1.2/redux-promise-middleware.min.js"
      integrity="sha512-yoJ8Iqdgzkt5HKscGJUhIZm2G8Fkh6rSyAjJUc5bL/gX7OpOsmrsZYKRgWFHkGQXO1IYPhMkxswZalC9usDONw=="
      crossorigin="anonymous"
    ></script>

    <!-- API  -->
    <script src="https://tylermcginnis.com/goals-todos-api/index.js"></script>

    <script src="index.js"></script>
    <script type="text/babel">
      /**
       * Definition for TODO
       * @typedef {Object} todo
       * @property {string} id - todo ID
       * @property {boolean} complete - todo complete status
       * @property {string} name - todo name
       */

      /**
       * Definition for Goal
       * @typedef {Object} goal
       * @property {string} id - goal ID
       * @property {string} name - goal name
       */

      /**
       * Definition for id
       * @typedef {string} id - object ID
       */

      /**
       * List component: Renders the List component UI
       * @param {object} props - List component props
       * @param {todo[] | goal[]} props.items - The list items
       * @param {function} props.remove - Remove item function
       * @param {function} [props.toggle] - Toggle todo function
       * @returns {object} - The UI DOM object
       */
      const List = ({ items, remove, toggle }) => (
        <ul>
          {items.map((item) => (
            <li key={item.id}>
              <span
                onClick={() => toggle && toggle(item.id)}
                style={{ textDecoration: item.complete && "line-through" }}
              >
                {item.name}
              </span>
              <button onClick={() => remove(item)}>X</button>
            </li>
          ))}
        </ul>
      );

      /**
       * Todos component
       * @constructor
       */
      class Todos extends React.Component {
        /**
         * Adds a todo
         * @param {object} e - JS event object
         * @returns {promise}
         */
        addItem = (e) => {
          e.preventDefault();

          this.props.store.dispatch(
            handleAddTodo(this.input.value, () => (this.input.value = ""))
          );
        };

        /**
         * Removes a todo
         * @param {todo} todo - The todo to remove
         * @returns {promise}
         */
        removeItem = (todo) =>
          this.props.store.dispatch(handleDeleteTodo(todo));

        /**
         * Toggles a todo
         * @param {id} id - The todo id to toggle
         * @returns {promise}
         */
        toggleItem = (id) => this.props.store.dispatch(handleToggle(id));

        /**
         * Renders the Todos component UI
         * @returns {object} - The UI DOM object
         */
        render = () => (
          <div>
            <h1>Todos List</h1>

            <form>
              <input
                type="text"
                placeholder="Add Todo"
                aria-label="todo"
                ref={(input) => (this.input = input)}
              />
              <button onClick={this.addItem}>Add Todo</button>
            </form>

            <List
              items={this.props.todos}
              remove={this.removeItem}
              toggle={this.toggleItem}
            />
          </div>
        );
      }

      /**
       * Goals component
       * @constructor
       */
      class Goals extends React.Component {
        /**
         * Adds a goal
         * @param {object} e - JS event object
         * @returns {promise}
         */
        addItem = (e) => {
          e.preventDefault();

          this.props.store.dispatch(
            handleAddGoal(this.input.value, () => (this.input.value = ""))
          );
        };

        /**
         * Removes a goal
         * @param {goal} goal - The goal to remove
         * @returns {promise}
         */
        removeItem = (goal) =>
          this.props.store.dispatch(handleDeleteGoal(goal));

        /**
         * Renders the Goals component UI
         * @returns {object} - the UI DOM object
         */
        render = () => (
          <div>
            <h1>Goals</h1>

            <form>
              <input
                type="text"
                placeholder="Add Goal"
                aria-label="goal"
                ref={(input) => (this.input = input)}
              />

              <button onClick={this.addItem}>Add Goal</button>
            </form>
            <List items={this.props.goals} remove={this.removeItem} />
          </div>
        );
      }

      /**
       * App component
       * @constructor
       */
      class App extends React.Component {
        /**
         * Lifecycle method that runs after component has mounted
         */
        componentDidMount() {
          const { dispatch, subscribe } = this.props.store;

          subscribe(() => this.forceUpdate());

          dispatch(handleInitialData());
        }

        /**
         * Renders the App component UI
         * @returns {object} - The UI DOM object
         */
        render() {
          const { store } = this.props;

          const { loading, todos, goals } = store.getState();

          return !loading ? (
            <h3>loading</h3>
          ) : (
            <div>
              <h2>App</h2>
              <Todos store={store} todos={todos} />
              <Goals store={store} goals={goals} />
            </div>
          );
        }
      }

      ReactDOM.render(<App store={store} />, document.getElementById("app"));
    </script>
  </body>
</html>
